[["google-analytics.html", "Chapter 9 Analyzing traffic with Google Analytics 9.1 How it works 9.2 Setting up Google Analytics 9.3 Analyzing traffic using googleAnalyticsR 9.4 Closing thoughts", " Chapter 9 Analyzing traffic with Google Analytics This chapter shows you how to embed Google Analytics on your website to capture traffic from users. Additionally, this chapter will provide some guidance on how to analyze traffic using the R package googleAnalyticsR. If you haven’t already, complete the following prerequisites: Create your blogdown website and (optionally) add some content Deploy your site on Netlify Sign up for Google Analytics 9.1 How it works Once you sign up for Google Analytics, the main objectives are to create an Account and a Property for your website domain name, then obtain a Tracking ID. This tracking code will go in the config.yaml file on your website, which in turn will instruct Google Analytics to collect the data on user traffic to your website. 9.2 Setting up Google Analytics Follow these steps to integrate Google Analytics into your website: Sign in to Google Analytics and navigate to Admin &gt; Create Account. Example Under Account setup, provide an appropriate name (e.g. personal-website) and configure the Account Data Sharing Settings to your liking. The defaults should be fine. Click “Next.” Under Property setup, provide an appropriate name (e.g. personal-website-property). Under Property setup, click on “Show advanced options” to create a Universal Analytics property. For the Website URL, provide the URL to your website. Click “Next.” Example Under About you business, configure the settings to your liking. Click “Next” and accept the terms of service. Locate the Tracking ID by returning back to the Admin console and selecting the Account and Property that were created in the previous steps. Important: Make sure you locate the Universal Analytics property that reads property name (UA-XXXXXXX-X) and not the GA4 property. Under Property, click on Tracking Info &gt; Tracking Code (example). Copy the Tracking ID, which should appear in the form of UA-XXXXXXXXX-1. Example Return to your RStudio Project where you are developing your website. Open the file config.yaml in the main directory and locate the googleAnalytics: parameter. Depending on the theme, this parameter may be written or spelled slightly differently. Paste your Google Analytics Tracking ID here, e.g. googleAnalytics: 'UA-XXXXXXXXX-1'. Example. Push your changes to your GitHub repository to complete the Google Analytics integration. 9.3 Analyzing traffic using googleAnalyticsR googleAnalyicsR is an R package for analyzing Google Analytics data stemming from traffic to your website. 9.3.1 Dimensions and metrics In order to analyze your Google Analytics data, you need to gain a basic understand of Dimensions and Metrics. Dimensions are attributes of your data and Metrics are quantitative measurements. For example, to analyze the count of users on your website in the last 60 days, the Dimension is date and the Metric is users. Google Analytics supports hunderds of Dimension-Metric combinations. My recommendation is to browse Ultimate Google Analytics Dimensions and Metrics List to learn what is available. Also check out the Practical Tips page written by the author of the googleAnalyticsR package. 9.3.2 Install googleAnalyticsR install.packages(&quot;googleAnalyticsR&quot;, dependencies = TRUE) 9.3.3 R packages for data analytics library(googleAnalyticsR) ## calling Google Analytics API library(dplyr) ## data manipulation library(plotly) ## interactive charts library(DT) ## interactive tables library(leaflet) ## interactive maps 9.3.4 Authenticate your Google Analytics account Running ga_auth() in the R console will automatically open a page in your web browser and prompt you to authenticate your Google account. googleAnalyticsR::ga_auth() 9.3.5 List your Google Analytics accounts and properties Running ga_account_list() will list the Google Analytics account that was created in step 1 of Setting up Google Analytics. ## get your accounts ga_accounts &lt;- ga_account_list() ga_accounts ## # A tibble: 2 x 10 ## accountId accountName internalWebPrope… level websiteUrl type webPropertyId webPropertyName viewId ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 143402170 abndistro 204792927 STAND… http://abndi… WEB UA-143402170… Abnormal Distr… 19810… ## 2 143402170 abndistro 269232613 STAND… https://www.… WEB UA-143402170… workboots-webs… 24127… ## # … with 1 more variable: viewName &lt;chr&gt; 9.3.6 Obtain viewId associated with your website To send API calls to Google Analytics, you need to obtain the viewId associated with the account. view_id &lt;- ga_accounts %&gt;% filter(accountName == &quot;abndistro&quot;, webPropertyName == &quot;Abnormal Distributions&quot;) %&gt;% pull(viewId) print(view_id) ## [1] &quot;198103217&quot; 9.3.7 Daily count of website users To query the count of website users over a given date range, use the following Dimension and Metric. Dimension: date Metric: users daily_users &lt;- google_analytics( viewId = view_id, date_range = c(&quot;2019-07-01&quot;, &quot;2019-12-31&quot;), metrics = &quot;users&quot;, dimensions = &quot;date&quot; ) %&gt;% as_tibble() plot_ly( data = daily_users, x = ~date, y = ~users, mode = &quot;lines&quot; ) %&gt;% layout(title = &quot;Daily count of website between June 2019 and December 2019&quot;) 9.3.8 Users by device type To understand which device types your users are using to view your website, use the following Dimension and Metric. Dimension: deviceCategory Metric: users users_by_device_type &lt;- google_analytics( viewId = view_id, date_range = c(&quot;2019-01-01&quot;, &quot;2019-12-31&quot;), metrics = &quot;users&quot;, dimensions = &quot;deviceCategory&quot; ) %&gt;% as_tibble() plot_ly( data = users_by_device_type, x = ~deviceCategory, y = ~users, type = &quot;bar&quot; ) %&gt;% layout(title = &quot;Users by device type&quot;) 9.3.9 Page views by page To measure the number of page views to each of your website pages, use the following Dimension and Metric. Dimension: pageTitle Metric: pageviews page_views &lt;- google_analytics( viewId = view_id, date_range = c(&quot;2019-01-01&quot;, &quot;2020-12-31&quot;), metrics = &quot;pageviews&quot;, dimensions = &quot;pageTitle&quot; ) %&gt;% as_tibble() page_views %&gt;% arrange(desc(pageviews)) %&gt;% DT::datatable() 9.3.10 Users by location To understand the geographical areas from which your webiste users view your webiste, use the following Dimension sand Metric. Dimensions: latitude, longitude Metric: users users_location &lt;- google_analytics( viewId = view_id, date_range = c(&quot;2019-01-01&quot;, &quot;2020-12-31&quot;), metrics = &quot;users&quot;, dimensions = c(&quot;latitude&quot;, &quot;longitude&quot;), anti_sample = T ) %&gt;% as_tibble() %&gt;% mutate_at(vars(latitude, longitude), list(as.numeric)) users_location %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircleMarkers( lng = ~longitude, lat = ~latitude, radius = ~log(users), stroke = FALSE, fillOpacity = 0.5 ) 9.3.11 Avoiding data sampling The google_analytics() function has an argument named anti_sampling, which is set to TRUE by default. This means that queries which return more than 1,000 rows of data will be sampled to avoid putting strain on the Google Analytics API. To avoid this default sampling strategy, set anti_sampling = FALSE when making API calls via the google_analytics() function. 9.4 Closing thoughts Google Analytics is a complex topic which cannot be covered in its entirety in this book. For most, having a basic understanding of the available Google Analytics Dimensions and Metrics should provide a solid foundation for interesting data analytics. "]]
